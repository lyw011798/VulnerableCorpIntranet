---
title: 1141 SS&RE personal report

---

# Vulnerability Report: CorpIntranet Profile Manager

**TeamMembers**: 114598067 劉昱萬 、114598055 洪訢瑀

**GitHub**: https://github.com/lyw011798/VulnerableCorpIntranet

## Goal
This project focuses on a corporate intranet portal designed for employee self-service, including profile updates and information retrieval. Due to the perceived safety of internal networks, such systems often lack rigorous security controls, leading to vulnerabilities in backend update logic. Specifically, this project addresses a Mass Assignment vulnerability that allows standard employees to escalate their privileges to an administrative level. The objective is to demonstrate the critical risks of unauthorized access to confidential data and to implement a secure remediation. 

## 1. Environment Description
The application is a **Flask (Python)** web application running in a **Dockerized environment**.
- **Framework**: Flask 2.x (Python 3.9)
- **Database**: SQLite (local file `database.db`)
- **Containerization**: Docker & Docker Compose
- **Frontend**: HTML5, CSS3, Vanilla JavaScript
- **Local Setup**: The application runs on `http://localhost:5000`.

## 2. Vulnerability Description
**Vulnerability Type**: Mass Assignment (also known as Object Injection or Auto-Binding).

**Affected Component**:
- **File**: `app/app.py`
- **Function**: `update_profile_vulnerable` (mapped to `/api/profile/update`)
- **Line Range (Original)**: Lines 63-67 (approximate)

**Description**:
The application implemented a profile update feature that blindly accepted all keys provided in the JSON request body and assigned them to the `User` database object using a loop and `setattr`.
```python
# Vulnerable Code Snippet
for key, value in data.items():
    if hasattr(user, key):
        setattr(user, key, value) # <--- Vulnerability
```

**Risk Level**: **High (Critical)**
- **Impact**: Privilege Escalation.
- **Exploit**: An attacker can inject a `"role": "admin"` key-value pair into the update request. The application processes this key and updates the user's role in the database, granting administrative privileges.

## 3. Attack Method
1. **Login via Browser:**
   - Login as `jdoe` / `password`.
   - Observe the "Employee Dashboard" image.

2. **Perform the Attack (Terminal):**
   - Open terminal.
   - Execute the following command to simulate the attack (assuming you have the token, or just use the curl login flow):
   
   **Step 1: Login to get Token**
   ```
   # Windows PowerShell
   $response = Invoke-RestMethod -Uri http://localhost:5000/api/login -Method Post -Body '{"username":"jdoe", "password":"password"}' -ContentType "application/json"
   $token = $response.token
   Write-Host "Token: $token"
   ```

   **Step 2: Send Malicious Payload**
   ```
   # Use the token from above
   Invoke-RestMethod -Uri http://localhost:5000/api/profile/update -Method Post -Headers @{Authorization=$token} -Body '{"email": "hacker@evil.com", "role": "admin"}' -ContentType "application/json"
   ```

3. **Verify Result:**
   - Go back to the browser and refresh the page.
   - **Observe:**
     - The main image changes to "TOP SECRET / ADMIN CONTROL".
     - The Role is now displayed as `admin`.
     - **Conclusion:** The application blindly accepted the `role` field via the API.
## 4. Proposed Fixes
**Remediation Strategy**: Implement a **Whitelist** (Strict Input Validation).
Instead of iterating through all provided keys, the application should only explicitly update fields that are safe and allowed to be modified by the user (e.g., `email`).

**Secure Code Snippet (`app/app.py`)**:
```python
# SECURE IMPLEMENTATION: Whitelist approach
# Only allow specific fields to be updated
if 'email' in data:
    user.email = data['email']
        
# 'role' and other sensitive fields are explicitly ignored
db.session.commit()
```

**Why it is Secure**:
This approach ensures that sensitive fields like `role`, `password_hash`, or `id` cannot be modified by the user, regardless of what they send in the request body. The application dictates what can be changed, not the user input.

## 5. Verification & Reflection
**Verification Steps**:
1.  **Before Fix**:
    - Sent `POST /api/profile/update` with `{"role": "admin"}`.
    - **Result**: User role changed to `admin`. Privilege escalation successful.
2.  **After Fix**:
    - Applied the whitelist patch.
    - Sent `POST /api/profile/update` with `{"role": "admin"}`.
    - **Result**: User role remained `user`. The `role` field was ignored.
    - **Confirmation**: Verified via Dashboard UI and API response.

**Reflection**:
This vulnerability highlights the danger of trusting user input and using convenience methods (like dynamic attribute assignment) without proper safeguards. Explicitly defining allowed input (whitelisting) is a fundamental security principle that effectively neutralizes this class of attacks.

## 6. Runtime Screen
![111](https://hackmd.io/_uploads/S1zpg8h-bg.jpg)

![5](https://hackmd.io/_uploads/HkYgCX2Wbl.jpg)
![1](https://hackmd.io/_uploads/rkxhjXn-Wl.jpg)
![2](https://hackmd.io/_uploads/HJLGnmhW-x.jpg)

![4](https://hackmd.io/_uploads/HJbCn7nbbg.jpg)

## 7. Conclusion
 

### Purpose and Achievement of Objectives
The primary purpose of this project was to demonstrate the mechanics and risks of **Mass Assignment (Object Injection)** vulnerabilities within a corporate intranet environment. The project successfully achieved its objectives by deploying a containerized application (Docker) that replicated a realistic internal employee portal. We successfully simulated a scenario where a standard employee could exploit insecure backend logic to elevate their privileges to an administrator level, subsequently gaining unauthorized access to restricted content. Furthermore, the project met its remediation goals by implementing a secure version of the API using explicit field **whitelisting**, proving the effectiveness of proper server-side validation.

### Significance and Contributions to the Field
This project contributes to the field of application security by providing a tangible demonstration of Authorization and Role Validation failures, which are critical components of the **OWASP Top 10**. It highlights that security vulnerabilities are not limited to external-facing applications; internal tools developed with a lower security posture are equally susceptible. The implementation serves as a practical case study for understanding how "auto-binding" features in modern web frameworks—while convenient for rapid development—can introduce severe security risks if not managed correctly.

### Overall Implications
The overall implication of this study is that "security by obscurity"—trusting the safety of an internal network—is a dangerous fallacy. The successful exploitation of the system demonstrated that **authentication alone is insufficient** to protect sensitive data without authoritative authorization checks. The project reinforces the necessity of treating all user input as untrusted, regardless of the user's origin or the application's environment.

### Mistakes and Mitigation
The critical mistake identified in the vulnerable implementation was the reliance on client-side input to determine data integrity and the use of blind object updating methods (e.g., passing raw JSON directly to the database model). To avoid this, developers must reject the practice of "blacklisting" fields and instead adopt a strict **whitelisting approach**, where only explicitly allowed parameters are processed by the server.

### Successes to Retain
A key success to retain was the use of an **isolated environment (Docker)** for testing, which allowed for safe verification of vulnerabilities without risking production systems. Additionally, the **comparative methodology**—developing both a vulnerable and a secure endpoint side-by-side—proved to be an effective pedagogical tool, offering immediate validation that the proposed code fixes successfully mitigated the risk.

### Future Improvements and Recommendations
For future improvements, the system could be expanded to include more granular **Role-Based Access Control (RBAC)** rather than a binary User/Admin distinction. We also recommend integrating **automated schema validation libraries** (such as Pydantic or Marshmallow) to enforce strict typing and field validation at the API entry point. Finally, implementing comprehensive **logging and auditing** for sensitive actions would ensure that even if an intrusion occurs, it can be detected and analyzed.